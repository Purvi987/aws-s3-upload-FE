{
  "version": 3,
  "sources": ["../../../../../node_modules/@trademe/ng-defer-load/fesm2020/trademe-ng-defer-load.mjs"],
  "sourcesContent": ["import { isPlatformServer, isPlatformBrowser, CommonModule } from '@angular/common';\nimport * as i0 from '@angular/core';\nimport { EventEmitter, PLATFORM_ID, Directive, Inject, Input, Output, NgModule } from '@angular/core';\nimport { fromEvent } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nclass DeferLoadDirective {\n  constructor(_element, _zone, platformId) {\n    this._element = _element;\n    this._zone = _zone;\n    this.platformId = platformId;\n    this.preRender = true;\n    this.fallbackEnabled = true;\n    this.removeListenersAfterLoad = true;\n    this.deferLoad = new EventEmitter();\n    this.checkForIntersection = entries => {\n      entries.forEach(entry => {\n        if (this.checkIfIntersecting(entry)) {\n          this.load();\n          if (this._intersectionObserver && this._element.nativeElement) {\n            this._intersectionObserver.unobserve(this._element.nativeElement);\n          }\n        }\n      });\n    };\n    this.onScroll = () => {\n      if (this.isVisible()) {\n        this._zone.run(() => this.load());\n      }\n    };\n  }\n  ngOnInit() {\n    if (isPlatformServer(this.platformId) && this.preRender || isPlatformBrowser(this.platformId) && !this.fallbackEnabled && !this.hasCompatibleBrowser()) {\n      this.load();\n    }\n  }\n  ngAfterViewInit() {\n    if (isPlatformBrowser(this.platformId)) {\n      if (this.hasCompatibleBrowser()) {\n        this.registerIntersectionObserver();\n        if (this._intersectionObserver && this._element.nativeElement) {\n          this._intersectionObserver.observe(this._element.nativeElement);\n        }\n      } else if (this.fallbackEnabled) {\n        this.addScrollListeners();\n      }\n    }\n  }\n  hasCompatibleBrowser() {\n    const hasIntersectionObserver = ('IntersectionObserver' in window);\n    const userAgent = window.navigator.userAgent;\n    const matches = userAgent.match(/Edge\\/(\\d*)\\./i);\n    const isEdge = !!matches && matches.length > 1;\n    const isEdgeVersion16OrBetter = isEdge && !!matches && parseInt(matches[1], 10) > 15;\n    return hasIntersectionObserver && (!isEdge || isEdgeVersion16OrBetter);\n  }\n  ngOnDestroy() {\n    this.removeListeners();\n  }\n  registerIntersectionObserver() {\n    if (!!this._intersectionObserver) {\n      return;\n    }\n    this._intersectionObserver = new IntersectionObserver(entries => {\n      this.checkForIntersection(entries);\n    }, {});\n  }\n  checkIfIntersecting(entry) {\n    // For Samsung native browser, IO has been partially implemented whereby the\n    // callback fires, but entry object is empty. We will check manually.\n    if (entry && entry.time) {\n      return entry.isIntersecting && entry.target === this._element.nativeElement;\n    }\n    return this.isVisible();\n  }\n  load() {\n    if (this.removeListenersAfterLoad) {\n      this.removeListeners();\n    }\n    this.deferLoad.emit();\n  }\n  addScrollListeners() {\n    if (this.isVisible()) {\n      this.load();\n      return;\n    }\n    this._zone.runOutsideAngular(() => {\n      this._scrollSubscription = fromEvent(window, 'scroll').pipe(debounceTime(50)).subscribe(this.onScroll);\n    });\n  }\n  removeListeners() {\n    this._scrollSubscription?.unsubscribe();\n    this._intersectionObserver?.disconnect();\n  }\n  isVisible() {\n    let scrollPosition = this.getScrollPosition();\n    let elementOffset = this._element.nativeElement.getBoundingClientRect().top + window.scrollY;\n    return elementOffset <= scrollPosition;\n  }\n  getScrollPosition() {\n    // Getting screen size and scroll position for IE\n    return window.scrollY + (document.documentElement.clientHeight || document.body.clientHeight);\n  }\n}\nDeferLoadDirective.ɵfac = function DeferLoadDirective_Factory(t) {\n  return new (t || DeferLoadDirective)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.NgZone), i0.ɵɵdirectiveInject(PLATFORM_ID));\n};\nDeferLoadDirective.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n  type: DeferLoadDirective,\n  selectors: [[\"\", \"deferLoad\", \"\"]],\n  inputs: {\n    preRender: \"preRender\",\n    fallbackEnabled: \"fallbackEnabled\",\n    removeListenersAfterLoad: \"removeListenersAfterLoad\"\n  },\n  outputs: {\n    deferLoad: \"deferLoad\"\n  }\n});\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(DeferLoadDirective, [{\n    type: Directive,\n    args: [{\n      selector: '[deferLoad]'\n    }]\n  }], function () {\n    return [{\n      type: i0.ElementRef\n    }, {\n      type: i0.NgZone\n    }, {\n      type: Object,\n      decorators: [{\n        type: Inject,\n        args: [PLATFORM_ID]\n      }]\n    }];\n  }, {\n    preRender: [{\n      type: Input\n    }],\n    fallbackEnabled: [{\n      type: Input\n    }],\n    removeListenersAfterLoad: [{\n      type: Input\n    }],\n    deferLoad: [{\n      type: Output\n    }]\n  });\n})();\nclass DeferLoadModule {}\nDeferLoadModule.ɵfac = function DeferLoadModule_Factory(t) {\n  return new (t || DeferLoadModule)();\n};\nDeferLoadModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: DeferLoadModule,\n  declarations: [DeferLoadDirective],\n  imports: [CommonModule],\n  exports: [DeferLoadDirective]\n});\nDeferLoadModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n  imports: [CommonModule]\n});\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(DeferLoadModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule],\n      declarations: [DeferLoadDirective],\n      exports: [DeferLoadDirective]\n    }]\n  }], null, null);\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { DeferLoadDirective, DeferLoadModule };\n"],
  "mappings": "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",
  "names": []
}
